import{_ as e}from"./index-BgMP_wVT.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";import"https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";import"./react-vendor-B_uAldPx.js";const t={apiKey:"AIzaSyClwLix-PHVCV9soMjiOzvIhZTYyLrPqYU",authDomain:"norron-5cf3c.firebaseapp.com",projectId:"norron-5cf3c",storageBucket:"norron-5cf3c.firebasestorage.app",messagingSenderId:"553127903115",appId:"1:553127903115:web:c9f895fec921ed2594f98e"};async function r(){const e=new TextEncoder,t=await crypto.subtle.importKey("raw",e.encode("norron-apps-2024-key-encryption-v1"),{name:"PBKDF2"},!1,["deriveBits","deriveKey"]);return crypto.subtle.deriveKey({name:"PBKDF2",salt:e.encode("norron-salt"),iterations:1e5,hash:"SHA-256"},t,{name:"AES-GCM",length:256},!1,["encrypt","decrypt"])}async function i(e){const t=new TextEncoder,i=await r(),n=crypto.getRandomValues(new Uint8Array(12)),o=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},i,t.encode(e)),a=new Uint8Array(n.length+o.byteLength);return a.set(n),a.set(new Uint8Array(o),n.length),btoa(String.fromCharCode(...a))}async function n(e){const t=new TextDecoder,i=await r(),n=Uint8Array.from(atob(e),e=>e.charCodeAt(0)),o=n.slice(0,12),a=n.slice(12),s=await crypto.subtle.decrypt({name:"AES-GCM",iv:o},i,a);return t.decode(s)}let o=null,a=null,s=null,c=null;async function u(){if(!o)try{const{initializeApp:r}=await e(async()=>{const{initializeApp:e}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js");return{initializeApp:e}},[]),{getAuth:i,GoogleAuthProvider:n,signInWithPopup:c}=await e(async()=>{const{getAuth:e,GoogleAuthProvider:t,signInWithPopup:r}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js");return{getAuth:e,GoogleAuthProvider:t,signInWithPopup:r}},[]),{getFirestore:u}=await e(async()=>{const{getFirestore:e}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");return{getFirestore:e}},[]);o=r(t),a=i(o),s=u(o),window.__firebaseImports={GoogleAuthProvider:n,signInWithPopup:c,getAuth:i}}catch(r){throw new Error("Failed to initialize Firebase. Check your configuration.")}}async function w(){if(!a)throw new Error("Firebase not initialized. Call initFirebase() first.");try{const{GoogleAuthProvider:e,signInWithPopup:t}=window.__firebaseImports,r=new e,i=await t(a,r);return c={userId:i.user.uid,email:i.user.email,name:i.user.displayName,firebaseUser:i.user},c}catch(e){throw new Error("Google sign-in failed: "+e.message)}}function p(){return a?.currentUser?{userId:a.currentUser.uid,email:a.currentUser.email,name:a.currentUser.displayName}:c}async function l(t){if(!a?.currentUser)throw new Error("Not signed in");if(!s)throw new Error("Firestore not initialized");try{const{doc:r,setDoc:n}=await e(async()=>{const{doc:e,setDoc:t}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");return{doc:e,setDoc:t}},[]),o={geminiKey:await i(t.geminiKey),githubToken:t.githubToken?await i(t.githubToken):null,email:a.currentUser.email,updatedAt:(new Date).toISOString()},c=r(s,"users",a.currentUser.uid);await n(c,o)}catch(r){throw new Error("Failed to save keys: "+r.message)}}async function g(){if(!a?.currentUser)throw new Error("Not signed in");if(!s)throw new Error("Firestore not initialized");try{const{doc:t,getDoc:r}=await e(async()=>{const{doc:e,getDoc:t}=await import("https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js");return{doc:e,getDoc:t}},[]),i=t(s,"users",a.currentUser.uid),o=await r(i);if(!o.exists())return null;const c=o.data();return{geminiKey:c.geminiKey?await n(c.geminiKey):null,githubToken:c.githubToken?await n(c.githubToken):null}}catch(t){return null}}export{p as getCurrentUser,u as initFirebase,g as retrieveKeys,l as saveKeys,w as signInWithGoogle};
